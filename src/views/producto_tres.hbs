<div>
    <script src="https://cdn.tailwindcss.com"></script>
</div>

<body>
   <div class="bg-gray-200 flex items-center justify-center min-h-screen px-4 py-8">
        <div class="container grid grid-cols-1 gap-12 justify-items-center">  

        {{#each pro}}

        <div class="w-full max-w-4xl group bg-white/80 backdrop-blur-2xl 
            /* BORDE: Más grueso y definido */
            border-2 border-white/50 
            rounded-[3.5rem] p-10 
            /* SOMBRA: Profunda y suave para dar efecto de elevación */
            shadow-[0_20px_50px_rgba(0,0,0,0.1),0_10px_20px_rgba(0,0,0,0.05)] 
            /* EFECTO HOVER: La sombra se expande y el borde brilla */
            hover:shadow-[0_40px_100px_rgba(0,0,0,0.2)] 
            hover:border-white/80
            transition-all duration-500 ease-in-out">
            <div>
                <h3 class="text-2xl font-bold text-blue-600 uppercase tracking-wider mb-1 text-center">{{des}}</h3>

            </div>
            <!-- Contenedor Imagen con Zoom -->
            <div class="relative overflow-hidden rounded-[1.5rem] bg-gray-100 aspect-square mb-6">
                <img src="{{foto2}}" alt="{{des}}"
                    class="object-cover w-full h-full group-hover:scale-110 transition-transform duration-700 ease-in-out" />
                <span
                    class="absolute top-3 left-3 bg-black/80 backdrop-blur-md text-white text-[10px] font-bold uppercase tracking-widest px-3 py-1 rounded-full">
                    Nuevo
                </span>
            </div>

            <!-- Información del Producto -->
            <div class="px-2">
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900 leading-tight">{{nota}} </h2>
                    </div>
                    <div class="text-right">
                        <p class="text-[18px] text-gray-400 line-through">$ {{precio1_10p}}</p>
                        <p class="text-[20px] font-black text-gray-900">$ {{precio1f}}</p>
                        
                    </div>
                </div>

                <p class="text-sm text-gray-500 leading-relaxed mb-6 line-clamp-2">
                    Protegé tu iPhone con una funda de silicona suave al tacto, elegante y diseñada para un ajuste
                    perfecto.
                </p>

                <!-- Controles de Interacción -->
                <div class="flex items-center gap-4">
                    <!-- Selector de Cantidad Estilo Minimalista -->
                    <div class="flex items-center bg-gray-50 rounded-2xl p-2 border border-gray-200 w-fit">

                        <!-- Botón Menos: de w-8 h-8 a w-11 h-11 -->
                        <button
                            class="w-11 h-11 flex items-center justify-center rounded-xl hover:bg-white hover:shadow-md active:scale-90 transition-all text-gray-400 hover:text-black border border-transparent hover:border-gray-100">
                            <span class="text-2xl leading-none font-medium">-</span>
                        </button>

                        <!-- Número: de text-sm a text-base y más ancho (w-12) -->
                        <span class="w-12 text-center font-bold text-gray-900 text-base select-none">
                            1
                        </span>

                        <!-- Botón Más: de w-8 h-8 a w-11 h-11 -->
                        <button
                            class="w-11 h-11 flex items-center justify-center rounded-xl hover:bg-white hover:shadow-md active:scale-90 transition-all text-gray-400 hover:text-black border border-transparent hover:border-gray-100">
                            <span class="text-2xl leading-none font-medium">+</span>
                        </button>
                    </div>

                    <!-- Botón Agregar con Gradiente -->
                    <button
                        class="px-6 py-2 bg-gradient-to-r from-gray-900 via-gray-800 to-black text-white text-sm font-bold rounded-2xl shadow-lg active:scale-95 transition-all duration-200">
                        Agregar al carrito
                    </button>
                </div>
            </div>
        </div>
        {{/each}}
    </div>
   </div>

    <script type="text/javascript">
        let items = 0;

        $(document).ready(function () {
            console.log('pulsa producto_tres');

            var self = this;

            console.log('this');
            console.dir(this);

            $('#search').keyup(function () {
                console.log('busca');
                search_table($(this).val());
            });

            function search_table(value) {
                $('#tabla tr').each(function () {
                    var found = 'false';
                    $(this).each(function () {
                        if ($(this).text().toLowerCase().indexOf(value.toLowerCase()) >= 0) {
                            found = 'true';
                        }
                    });
                    if (found == 'true') {
                        $(this).show();
                    }
                    else {
                        $(this).hide();
                    }
                });
            }


            $('.plus-btn').on('click', function (e) {

                console.log('aa');
                var id = (e.target.value);
                var str = parseFloat($("#cantidad_" + id).val());
                var unidad = parseFloat($("#unidad_" + id).val());
                var price = parseFloat($("#precio_" + id).val());
                var tipo = $("#tipo_" + id).val();
                var stotal = parseFloat($("#total_" + id).val());
                console.log("unidad", unidad);
                console.dir(tipo);
                console.log(price);
                console.log(unidad);
                console.log(str);
                let total_item = 0;
                console.log(str);
                if (tipo == 'kilo.') {
                    str = parseFloat(str + 1).toFixed(0); //  cantidad
                    total_item = parseFloat(price * str * unidad).toFixed(0);
                }
                else {
                    str = parseFloat(str + unidad).toFixed(0); //  cantidad
                    total_item = parseFloat(price * str).toFixed(0);
                }


                console.log(str);
                $("#cantidad_" + id).val(str);      // pone la cantidad en el value de cantidad
                $("#total_" + id).val(total_item);

            });



            $('.minus-btn').on('click', function (e) {
                var id = (e.target.value);
                var str = parseFloat($("#cantidad_" + id).val());
                var price = parseFloat($("#precio_" + id).val());
                var unidad = parseFloat($("#unidad_" + id).val());
                var tipo = $("#tipo_" + id).val();
                var stotal = parseFloat($("#total_" + id).val());



                //str = parseFloat(str).toFixed(2);
                console.log(str);
                console.log(unidad);



                if (str < unidad) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'El producto debe ser mayor a 0',
                        showConfirmButton: false,
                        timer: 2000
                    })
                    var str = 0;
                    var unidad = 0;
                }

                if (tipo == 'kilo.') {
                    str = parseFloat(str - 1).toFixed(0); //  cantidad
                    total_item = parseFloat(price * str * unidad).toFixed(0);
                }
                else {
                    str = parseFloat(str - unidad).toFixed(0); //  cantidad
                    total_item = parseFloat(price * str).toFixed(0);
                }
                //var total_item = parseFloat(price * str * unidad).toFixed(2);
                $("#cantidad_" + id).val(str);
                $("#total_" + id).val(total_item);


            });


            $('.sumacanasto').on('click', function (e) {

                console.log('agregar carrito');
                console.log(e.target);

                var id = (e.target.value),
                    cant = parseFloat($("#cantidad_" + id).val());
                console.log($("#tipo_" + id).val());
                // var stotal =  parseFloat($("#total_" + id).val());

                const infoProducto = {
                    id: id,
                    desc: $("#desc_" + id).val(),
                    img: $("#foto_" + id).val(),
                    cant: parseFloat($("#cantidad_" + id).val()),
                    unid: parseFloat($("#unidad_" + id).val()),
                    precio: parseFloat($("#precio_" + id).val()),
                    tipo: $("#tipo_" + id).val(),
                    stotal: parseFloat($("#total_" + id).val())
                };


                if (cant == 0) {


                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'El producto debe ser mayor a 0',
                        showConfirmButton: false,
                        timer: 2000
                    })
                }
                else {
                    let productosLS;
                    items = 0;
                    productosLS = obtenerProductosLocalStorage();
                    productosLS.forEach(function (productoLS) {

                        items++;
                        if (productoLS.id === infoProducto.id) {
                            productosLS = productoLS.id;
                        }
                    });



                    if (productosLS === infoProducto.id) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'El producto ya está en el carrito',
                            showConfirmButton: false,
                            timer: 2000
                        })
                    }
                    else {

                        let productos = [];
                        productos = obtenerProductosLocalStorage();
                        productos.push(infoProducto);
                        localStorage.setItem('productos', JSON.stringify(productos));
                        document.getElementById('items').value = productos.length;
                        Swal.fire({
                            icon: 'success',
                            title: 'Producto agregado al carrito',
                            showConfirmButton: false,
                            timer: 1500
                        })

                    }


                }


            });

            function obtenerProductosLocalStorage() {
                let productoLS;
                //Comprobar si hay algo en LS
                if (localStorage.getItem('productos') === null) {
                    console.log('no tiene');
                    productoLS = [];
                }
                else {
                    console.log('tiene');
                    console.dir(localStorage.getItem('productos'));
                    productoLS = JSON.parse(localStorage.getItem('productos'));

                }
                return productoLS;
            }


        });
    </script>
    <!--<script src="carrito.js"></script>-->
    <script>
        const carro = new Carrito();
        const carrito = document.getElementById('carrito');
        const productos = document.getElementById('lista-productos');
        const listaProductos = document.querySelector('#lista-carrito tbody');
        const vaciarCarritoBtn = document.getElementById('vaciar-carrito');
        const procesarPedidoBtn = document.getElementById('procesar-pedido');

        cargarEventos();

        function cargarEventos() {

            //Se ejecuta cuando se presionar agregar carrito
            productos.addEventListener('click', (e) => { carro.comprarProducto(e) });

            //Cuando se elimina productos del carrito
            carrito.addEventListener('click', (e) => { carro.eliminarProducto(e) });

            //Al vaciar carrito
            vaciarCarritoBtn.addEventListener('click', (e) => { carro.vaciarCarrito(e) });

            //Al cargar documento se muestra lo almacenado en LS
            document.addEventListener('DOMContentLoaded', carro.leerLocalStorage());

            //Enviar pedido a otra pagina
            procesarPedidoBtn.addEventListener('click', (e) => { carro.procesarPedido(e) });
        }
    </script>
    <!--<script src="pedido.js"></script>
    <script src="sweetalert2.min.js"></script>-->
</body>